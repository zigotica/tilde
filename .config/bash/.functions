#!/usr/bin/env bash

#####################################################################################
#                                                                           FUNCTIONS
#####################################################################################

# Create a new directory and enter it
function mkd() {
	mkdir -p "$@" && cd "$_";
}

# youtube downloader 
# use: ytd video-url
function ytd() {
  youtube-dl -f 'bestvideo+bestaudio/best/best' --merge-output-format mkv $1
}

# only audio
function ytda() {
	youtube-dl -x --audio-format flac $1
}

# https://github.com/nvm-sh/nvm#automatically-call-nvm-use
# use node version defined in .nvmrc file automatically upon cd into a project,
# if that project folder includes a .nvmrc file,
# otherwise, use default version defined in nvm ls
cdnvm(){
    cd "$@";
    nvm_path=$(nvm_find_up .nvmrc | tr -d '\n')

    # If there are no .nvmrc file do nothing (use default, so you better have one)
    # There is a .nvmrc file:
    if [[ $nvm_path = *[^[:space:]]* && -s $nvm_path/.nvmrc && -r $nvm_path/.nvmrc ]]; then
      declare nvm_version
      nvm_version=$(<"$nvm_path"/.nvmrc)

      # Add the `v` suffix if it does not exists in the .nvmrc file
      if [[ $nvm_version != v* ]]; then
        nvm_version="v""$nvm_version"
      fi

      # If it is not already installed, install it
      required_version_from_nvm_ls=$(nvm ls --no-colors "$nvm_version" | tail -1 | tr -d '\->*' | tr -d '[:space:]')
      if [[ "$required_version_from_nvm_ls" == "N/A" ]]; then
        nvm install "$nvm_version";
      fi

      nvm_current=$(nvm current)
      if [[ "$nvm_current" != "$nvm_version" ]]; then
        nvm use "$nvm_version";
      fi
    fi
}
alias cd='cdnvm' # alias after the function, just in case

