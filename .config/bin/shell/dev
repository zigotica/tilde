#!/usr/bin/env bash

# setup tmux session for development
# will create 1 right pane for AI, one main pane on left for coding, and two bottom panes for terminal
# requires being called from inside a tmux window/session
if [[ ! "$TERM" =~ screen ]]; then
  echo "You need to start a tmux session before running this function"
else
  tmux splitw -h
  tmux selectp -t 1
  tmux splitw -v
  tmux splitw -h
  tmux splitw -h

  # wait for each panel to be ready, then
  # if not in the first panel,
  # run cd . so they can use nvm version
  num=$(tmux list-panes | wc -l | xargs)
  for ((i=2; i<=$num; i++)); do
    tmux selectp -t $i
    while ! tmux capture-pane -p -t $i | grep " "; do
      sleep 1
    done
    tmux send-keys "cd ." C-m
  done

  # finally, run neovim in 1st split
  tmux selectp -t 1
  tmux send-keys "v" C-m # will not work with oh-my-posh, force via alias
fi
